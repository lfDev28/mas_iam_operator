# Apply this manifest to install the MAS IAM Operator via OLM.
# Replace every occurrence of `iam` if you want to target a different namespace.
# The first section creates a self-signed TLS secret suitable for development.
---
apiVersion: v1
kind: Secret
metadata:
  name: keycloakstack-sample-keycloak-openldap-tls
  namespace: iam
  labels:
    app.kubernetes.io/name: keycloakstack-sample
    app.kubernetes.io/component: openldap
  annotations:
    mas.ibm.com/generated-by: mas-iam-dev
    mas.ibm.com/description: Self-signed TLS material for the Keycloak/OpenLDAP integration (development use only).
type: kubernetes.io/tls
data:
  ca.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURSRENDQWl3Q0NRRFljVnE3RXVnbkpUQU5C
    Z2txaGtpRzl3MEJBUXNGQURCa01Rc3dDUVlEVlFRR0V3SlYKVXpFTk1Bc0dBMVVFQ0F3RVZHVnpk
    REVOTUFzR0ExVUVCd3dFVkdWemRERVFNQTRHQTFVRUNnd0hUVUZUSUVsQgpUVEVNTUFvR0ExVUVD
    d3dEUkdWMk1SY3dGUVlEVlFRRERBNU5RVk1nU1VGTklFUmxkaUJEUVRBZUZ3MHlOVEV3Ck1qRXdN
    elUwTXpOYUZ3MHlOakV3TWpFd016VTBNek5hTUdReEN6QUpCZ05WQkFZVEFsVlRNUTB3Q3dZRFZR
    UUkKREFSVVpYTjBNUTB3Q3dZRFZRUUhEQVJVWlhOME1SQXdEZ1lEVlFRS0RBZE5RVk1nU1VGTk1R
    d3dDZ1lEVlFRTApEQU5FWlhZeEZ6QVZCZ05WQkFNTURrMUJVeUJKUVUwZ1JHVjJJRU5CTUlJQklq
    QU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBcWk4Ymc4OTM0dk5pdlp3YjE4
    SXRCRUZvc08yREx1TnFwOCszSXczR0hjbzIKT0EwR0ptSkMzZmR4blVKUnJPVDFOSUtRZU5VOXZ5
    c3pBMzRGb0FIWFpmM3ExMEFtWW13VjVBSHJteEt6cDZlcgp5RHhwa1lyUjg4YzYvcURvSUpOeUtF
    MXJXTGJPWmpnMHArVkR3QWtkM2VJYVh5SnY0Qnd3NnRoTnRiNHdudDl5CmVEZWRvZi9ja1pQbnBu
    eDBNLytuWkJ0VSt1b1JSMTAwQVRZY2gxbVhRcWk4cXpmWVBxeEd6cUpDSW9sRXhLOHEKSFNtUnd4
    cmdSQlF6UXFRckFqN1ZvZUZKdGY1a2hDNnBkRlU4ak0vc0J0Y0FRTTh5NjUrVUZNM0Zxa2V5c2Uz
    MQpFODMzZWhycW5FQW93eVdDMHpUUnhFZzgvS1Jvb1Jlb0JUaTBBRTV3VlFJREFRQUJNQTBHQ1Nx
    R1NJYjNEUUVCCkN3VUFBNElCQVFBRE5pd1p6WDVKOHYxSUluaVZubEdocHN6WkdVRGZucWpkVkVj
    UEE2QVFQbytxUlQzSm9MWnQKZWlRTnEyd1ZIN0JzenQ1dE5yenMwWlBDRUJzWVozbThiYmg5Zkt2
    eEEyS2srRDVhVlBVRTFvR3B0UVg2N3JNRgpsODZxWis1aDg4MHlOeGdTUkZ0R0hjY0RGMnFnaE1n
    N1BWa01neTRzamNlaUFObmluYXBlNndYVTBQMFJCUjBFCjRwTjRxOE9LczgwMG5PTEVkUTdvZUJO
    aVE2T21HR3hnMGladGJoN3Z2TzRtWjF5Q3VZNGNFeEVQSE9lbFUyamwKVzZjMHl3M0JPNm9ORFB0
    NHBJN2hDSHAxYWtEd1lIL1REZldUaTA0TWdXM2hwRDRRbDVxSU13YnMzUmRTQXEzdQpvSks5R29j
    cUpBRDBVZFJraHFXdXRuT0hFa3U1U0JqNwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURSRENDQWl3Q0NRQ3ZOYngyOGh5UUZqQU5C
    Z2txaGtpRzl3MEJBUXNGQURCa01Rc3dDUVlEVlFRR0V3SlYKVXpFTk1Bc0dBMVVFQ0F3RVZHVnpk
    REVOTUFzR0ExVUVCd3dFVkdWemRERVFNQTRHQTFVRUNnd0hUVUZUSUVsQgpUVEVNTUFvR0ExVUVD
    d3dEUkdWMk1SY3dGUVlEVlFRRERBNU5RVk1nU1VGTklFUmxkaUJEUVRBZUZ3MHlOVEV3Ck1qRXdN
    elUwTkRSYUZ3MHlOakV3TWpFd016VTBORFJhTUdReEN6QUpCZ05WQkFZVEFsVlRNUTB3Q3dZRFZR
    UUkKREFSVVpYTjBNUTB3Q3dZRFZRUUhEQVJVWlhOME1SQXdEZ1lEVlFRS0RBZE5RVk1nU1VGTk1R
    d3dDZ1lEVlFRTApEQU5FWlhZeEZ6QVZCZ05WQkFNTURteGtZWEF1WkdWMkxteHZZMkZzTUlJQklq
    QU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBdFhBMkRQWGlTaXdLT0dzZ3pp
    MjZyWjFTdE81c2hXMWwzWWpnL0hYRFpZWXYKbWhnMWNoTVJFWXZoTWxVZjBhczNLMUNOcFdnRzhW
    aHZHcTJFdENyMzhTQ0xMdXZPTjh0ZjVaYlFyb29XMjZCcgo3TnVJR1ZtZGZ6bVhZYmo1dDhLU0hX
    ejNLcDg1bEppR1ZYT3AwcFJtR0htMDBkN2JuVjVERnNsN2pTWlBaNENkCnRCT01IQTFKWUhSR3gv
    NHZYcnhBMUxpVG5tbjRoQ1pTV203Y1dqcXlTL1lOWTNkS3dLQlAwTzFNeWhXZmVFZWEKdTNGZlNQ
    VFpqMVhocERESjhkdldSWjdsVnMxekRRNThhN3pnY2o2L1Z0c3RVV3ZtSzZnRkhBemNJeW1BRWJM
    OApmemg2UTlhM1FTR3BHbDZVc210ekRUNWh5MFVQZlhpOWFhd01hMmU2cHdJREFRQUJNQTBHQ1Nx
    R1NJYjNEUUVCCkN3VUFBNElCQVFDTWEvZjBFdlROOXFLZVNXSUZURWs2R0JZejdFSlAyMmVjUHVp
    Y05jcVlLUFh1eHRhU20zb28KZkllRTAwV1hqa0swWjBvUVlYUDJXV1M2SERobWZVTisrMXZQa21K
    SzR6WXo3eC9QaFo3MlJHaVBZTy9jL0Q0LwpyM3l5ZVkxdmlrZXBoeHljYmVNTGRzQ3dheGxWUG15
    L051TUszVXg2SzVDUWFxUjJ2WmUrZWphWGtvb21VOU9OCmpQRnVEeENPL0t2d09KN01lZU4yYUw0
    bzRYSVNnOFp1ZzhzQVVKUFNjSVFSZEFOY0p1VU5ac2srYnVJRjNXMy8KeERYREUxcGQ4TEttRVMw
    dWg0eFMzOWx3ZUp0emdNZnRpWDVZQ2lDSDVQZnVWK1ZzZkxzWFpiTjZ1UzYzeWhoSgoxSHNRYUJG
    RUJhL1dXUDJZT0g1TUtXOGx1RWVHUSszKwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: |
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZB
    QVNDQktjd2dnU2pBZ0VBQW9JQkFRQzFjRFlNOWVKS0xBbzQKYXlET0xicXRuVkswN215RmJXWGRp
    T0Q4ZGNObGhpK2FHRFZ5RXhFUmkrRXlWUi9ScXpjclVJMmxhQWJ4V0c4YQpyWVMwS3ZmeElJc3U2
    ODQzeTEvbGx0Q3VpaGJib0d2czI0Z1pXWjEvT1pkaHVQbTN3cElkYlBjcW56bVVtSVpWCmM2blNs
    R1lZZWJUUjN0dWRYa01XeVh1TkprOW5nSjIwRTR3Y0RVbGdkRWJIL2k5ZXZFRFV1Sk9lYWZpRUps
    SmEKYnR4YU9ySkw5ZzFqZDByQW9FL1E3VXpLRlo5NFI1cTdjVjlJOU5tUFZlR2tNTW54MjlaRm51
    Vld6WE1ORG54cgp2T0J5UHI5VzJ5MVJhK1lycUFVY0ROd2pLWUFSc3Z4L09IcEQxcmRCSWFrYVhw
    U3lhM01OUG1ITFJROTllTDFwCnJBeHJaN3FuQWdNQkFBRUNnZ0VBYjhDenFmdnc2MXFBMlFzeTQ0
    dExCaEIybHJhYjVQcmkyVGFyelJRRHpBNkEKVjFzOTRBdGFZZ0pVTEpvOXhQaStQRkdiVFJ2cjJz
    OXJiM1VjM1pQeHIzVXFCVFo4aCtVZUpkMWtuM3l5WTRoRgpzVmZ1Vmg3YVlUaHB3MmtaZGxQRGg1
    aE1ETmFSc3JMWFd0Nm81T2sra1NpMWRPYmRRZXFEVEEvQnA4akc4Nm84CnJzVnVsNkxoa1VrRktl
    WVRxT3IxdWNZNzd4Zko4VExWa09JdFB6ZUpjeTFQa21XcXlmUFVUdHJPZkRyaVFUVG8KdWdrcS9l
    TWtxd0xnSkQ0ajB0cHc1RU9sKzg3RHZFWnJXU3hEY1Bnbk5jekRwY0tTNC9IMVJ5Y2NHOVJJYmJp
    RApUajA4ZHJMTTA5VGQ2clhzZXN2MExWcWJSZU9ReXpESEdrN1Yvb2kxMFFLQmdRRGg4WlNNWnEz
    Vm9MWWhXWUtXCmptOEdGbzdsTUZqb1hJSzlleUFjTGVYb2FsVjlNSlZ5SWdmVktCbnNxMTBCSzdY
    dm9RcUkrUTNSdVpEWUZOU0IKemVkRjluY1RsM0NRQXlaT094MXIvVHZBbjg5dUxqeERxTTZUYTZo
    TkkzQ01rTFlqbHZXY0x2a090L0NITnhRcgp3enZqRHdJMjFoQWttUGhVU2FVU0dYdEliUUtCZ1FE
    Tmt3VDFRQWw4UllROXZha3BFeFFsekFiUXA4NURUWXZlCjBrdW5xL0I2MFZ5UFZvM2xkVVIxaEtU
    ZUhaOGxXMjFlQ3MwV3JTcW9hYXJXY3dYVDM0WVdrN0kyVmFtdHFIZksKV0RNQTJRb3l4UzBMcE1i
    SkJDdGpKV3pTRFk3anZObVVWVWE0RGpMaWYxMGljdGs1T2JiQklwVU5pbWNReGxSSQpCcHZwSm1O
    SzR3S0JnUURCbjJidmtxWnhwZEd1YnFpTUlPOWZ4a0VhZ3Y0TjBnbHdHMjErK0k1SFI2aVBLZTFI
    CjY0WE8weGkwU24zZkhQaENyRHo4K0lFeE10YS9kY3BPbW9jUTI0OWJ5TEY3bUZkaFB5T05nV3VO
    UE9aancxZDkKbTlHN1g4elFuZ2c3VFYvb3k5c2F4dDVFRUxrZEJzUlFaSFNUdGk3dGt6QXVUTEN5
    ZXBIdEdzMGRXUUtCZ0dMWAp1TCtQRGNDQjBFYTdaWldKUmR1eWtPaE1kdUZuYk1RelN3c1FvZXo3
    czB4OEtuZlVmWmtmc1FIWExra1EvN0lDCjhYOWd2YTBDT1pFbzl2bGJkU1p2MTNWR2xQSVptWmRo
    OXd3R1QxLy83RnUzMjVpVmQ2TVJRSlJ5em14enhnNEwKUHBpS3d5NmlYSTZPdUNGS3ZiTjVSRCto
    ZDFMYWVYVzBMOHpYbDFCUEFvR0FTT2U5R2ZBcEJwalp4U2Q4UlZ1UgpWODhVZG9tdXVKQ0M0ZkMx
    OGRzNjdrb0NFVlBHVXoyWEkyUTYvVSt3ZlBwV3VScmFxcmJzNzBySkJpeUVOMXdoCklGa1JFWStD
    TThERDRhRlQ5eU5HcXgyWENrQlJieVVWZzlDMG1mSDRpQ3BwS0drZm9rOXBDZHkwcXo4emNzM3EK
    YzNjS3NSMHJPVjZKaUI0T1F1NFFJMEk9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
  ldap-truststore.p12: |
    MIIJiQIBAzCCCU8GCSqGSIb3DQEHAaCCCUAEggk8MIIJODCCA+8GCSqGSIb3DQEHBqCCA+AwggPc
    AgEAMIID1QYJKoZIhvcNAQcBMBwGCiqGSIb3DQEMAQYwDgQIJLIPzEQXES4CAggAgIIDqKmP1Nla
    AEKG6WmJ6F/LnyZDGDW2gjdl9urzch3JZTT9cyOK2Yr3E46c/uQUJaTYaAVEVbv1zju/HOte0kiI
    0l0Eh/M9rYioSUG4gkeaKdN4oy3hYJqaEVMWNrRNquWeTQXu+UNyvzvy4CcSDKVKRIwqrINuEnhL
    SRoo4FIO9DZL9xEuMzhuAowP4nOJA/PQNiKmlhjwqdW8Er0ly/N+kveQwm1Wwu4MbDOvM1HEeGv1
    RY2t7TVIN9dkKoz8GSQ/1as4uxPpZ5UzEgoqk+q8aG64oD/pFa9Zxx1ZHwb6WFLLRwjSXB4T5Dh7
    3l1LC6O+0vm7dEOTlPCA0ugcA8WgxD1MygYPlAbJfjb2qbtFqyNJiSu0FvLhDMVffLilVj3prZXX
    zg0Dfv+2VytirPSuarAA95fiCzj+bUfna+DzQHsLgElMCG4pk6PaoITZt/uO34IyhHx2xflKTNJ+
    bi8KFVTr06gxvcSg3ngkpmO96avxAJSEq4TBq9BkGtGK59aLpahHSSozIFWUdliYmjyG+U/277UL
    1zciJa+yZaYb7twvE8Ji4a7oCABv/18Xp085YgBMc0nIrAVhOZDCY9kqXJk0cagMuDDR+YTmak7u
    gZpfPHuPPK0ogDtOf5YnPt1OCmVJLbIVUu+q0dtp13X+MFCLIlYEW2dTn/ZoeNSk5mFFL/aKyLPy
    brRm8QY10GxmF4cwjsoCiwWZOjdy90EQMT+hDN7TdzAmefmONla7Fk7gVgOZKHn6UE0HRC3Oxx/U
    7ya3fsNQITqE4dSu9xiEk8fDrayu+iqXMQiGGJ1Sl9338nb8JOzAB9HBXLMuyWIXUfBbGdgTk8gS
    TwLdhWTWrspqcUDvgtF/aFZhTeJgn4bnMS0BUNInAmjKy+Cm1rR9PwaXFbl+9dg5ybZatlpAUAtQ
    vs5oYI4Dtc8QlT+HaxnO1KyECw0mVXV7OLQwWuybH3Kp7Kp1CuLLs+U+ED5e67BfDLqw5YIQGP+f
    nIrtKQqZUCfCjmXxwfmigvRDKNWqt/WcTAc9fK/hXaSFd3sKWhQXC2j5mTXMv4Je+yAMQc7e8q+S
    j1FNBtt440FpAjN3WE1W/UXlPky+LkwYWi1wTzWn2lFgTcyHvzGlKAZD+tZJOTJT3QTs4f73JWiU
    kNL8snIiTDmu44Og3j5Zzoag2b4lQq5DKObqqTDXmGx5+33vnhNKyJrC6pMrkTxRH8nEFUXbbmLz
    sVtdmh7Q+yjIgVRbRIdRKqij7zCCBUEGCSqGSIb3DQEHAaCCBTIEggUuMIIFKjCCBSYGCyqGSIb3
    DQEMCgECoIIE7jCCBOowHAYKKoZIhvcNAQwBAzAOBAjMe1plJWqr5wICCAAEggTIqdxBqQD6Dzcd
    a9Rbj7osyYlOQ1unXv9ZoUEElKJK45iC67byHK3hpAHGYMX/h3e7xVLTDxNqD3doBPqTZwWcTFtJ
    4NL6VJOWDWnTyH3zdx722hhymXbfQjCX9smJ80v6tPLEh2LSouos7ISIS685cRP+QQFhnA3w5eeu
    om8ojflvUprjGVwd5huaox2WcqZKlbmSZqZ90GsL9h44XpgUJgQz86qGXlhilU6gXdIczcT3+7MH
    WY2seexbrkl+0ScKZFX+6AhH4kf2oCGChVaF+S30PikRKdce0Zhiy9ErSgUQofUXV4t1r931asPx
    yiQj3tSiInW8ARYG3f7u7YE9N8i0BToPliZiD5/rzgBBHC598DMWNoUt/rqqDDSFsq+6AuPW07jU
    bZkEteObuSqA2ouk1M/VaAV10MPmfsIxLrkWthxGmVhZ6gh8r3djh3BBbMtr6MlT0/yc2mLlKfK4
    UZnG48zFWeLkxW9GeHaFK5QVEXXI3QwFpvwpaoOAG11VsoOLxI8YqG8NtpptB3vO7qDGIWYuhNgW
    ASQwM76E3S0wi3otCecmzQxvghbTd7L0sjPJYi5j4Sw8s7lULY0zLVkWXFnIF7a0VmDdQPij4R0z
    6hN/9JKsUmPSzEPTDifLSgHinVNIn7Y2XAfA2erXoTGxyNEgCAaLraGyGWLIbL7vi8pB/OVkr1wZ
    4IRKyn1DVWr8HIOSdkfolYPYMPpC0xz2nyuxp2Y6YV3ZVAHMVqbB/XQdIsfhpjYKbNPbRMFWbQnS
    ytetyQJSnjeosIQPBuK76zvbbLgxvrwBd0KxnHyfLrnnoYM96wn5oIV97Tc8b1xuU6BvI+VSBlUT
    /B5WNCzYMuNDmvnCsY6J0AFD6J8QHiMDDSdj924SJ8AzBNWV8wAZvII1Piepu+U4hjtGcLE27WGF
    ajEx13ABnzANyTXWjCSvQh73j5g3XHoG+NJ+ugvwNGPzMMuJtB0QsS9CkyUY5rQr4klhniRT/sK9
    Styyzpc+rtqoWAYl2zjJn1/VDXsNji1p5zWLzLEhklSVs6ymyVvfGH8qSTtYLDFcfQ/IebMS/cYJ
    9tW4FR9tCiaSK/+Lryece5b6N8HJVLFJMgI8kC0fy9i3ZOb3TFh0ShLuPpXkspP8K0amGYCfg5hG
    uFo1a4eyDuc4va9xPDZMK4oJBDyQ1NHUYA/xqFmDXMnPYzzmrKHE5ORFACmXznasMQIhE68nFebU
    C70T+sBhhgpncVIks9p1icR0PkdA9niBDR/2E7lOs1dgbZ1H+b8EiOCT3Q/BVKeoKH6aC7F9/Uph
    xKKS7PV+KtsWiTW4JAII8AjQoBdW/4laqdtIT1Mymka3LoRc+5jj2+Gnf5qCjQIbo0dBESV5GUMI
    XIPM5NT9dNw9mIOX/klWrTz93d7itFroLZn7wxzEAOw2grKoz+T0zUo3Dbwlj2fFlHE1nWVq3byV
    SZW1gcQKUXsstgEGGlsohtmRk8ciFlK3bXuTJEVfjHuBIqwv3+PfoW82B0TPs2InlmvX8Hiw73E0
    /Dv2o5r8uq0MGoCdukJcLgt24OwA3/J4CZGOYro358QBVrmjV8ntDmiRH52PawzXux6HqyQjDSdZ
    LGLOEdMX32CE4GU+m6UmJ0AkMSUwIwYJKoZIhvcNAQkVMRYEFFEzQxxk0n8fb5/Bpo2h0b11Nb6J
    MDEwITAJBgUrDgMCGgUABBTul8JCwrRTSNdhN4ztNdzsSzVMCwQInAs5TOcclB8CAggA
---
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: mas-iam-operator
  namespace: openshift-marketplace
spec:
  displayName: MAS IAM Operator
  image: quay.io/lee_forster/mas-iam-operator:catalog-0.0.2
  sourceType: grpc
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: iam-operator-group
  namespace: iam
spec:
  targetNamespaces:
  - iam
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: keycloak-stack-operator
  namespace: iam
spec:
  channel: alpha
  installPlanApproval: Automatic
  name: keycloak-stack-operator
  source: mas-iam-operator
  sourceNamespace: openshift-marketplace
---
# Optional: example KeycloakStack custom resource once the operator CSV is ready.
# Ensure the required LDAP TLS secret exists (see documentation) before applying.
apiVersion: iam.iam.mas.ibm.com/v1alpha1
kind: KeycloakStack
metadata:
  name: keycloakstack-sample
  namespace: iam
spec:
  keycloak:
    ldap:
      autoConfigure: true
      # Populate with the name of the secret containing LDAP bind credentials.
      bindCredentialSecret: ""
      # Provide the ldaps:// endpoint for your LDAP server.
      connectionUrl: ""
      tls:
        enabled: true
        caSecret: keycloakstack-sample-keycloak-openldap-tls
  openldap:
    enabled: true
  postgresql:
    auth:
      password: keycloak123
      postgresPassword: admin123
    global:
      postgresql:
        auth:
          password: keycloak123
          postgresPassword: admin123
    primary:
      persistence:
        storageClass: rook-ceph-block
